---
- name: save dumps
  hosts: main_server 
  become: yes
  tasks:
    - name: cd to compose file path
      shell: cd /home/ubuntu/workspace
    - name: create new dump
      shell: docker compose exec -it db pg_dump -U test -d testdb > /home/ubuntu/workspace/dumps/dump-$(date '+%F|%H:%M:%S').dump
    - name: message on mail
      shell: echo "Dump обновился" | ssmtp -C/etc/ssmtp/ssmtp.conf god.winer@yandex.ru
